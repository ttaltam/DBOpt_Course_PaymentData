### **Задача 3.**
_Реализовать предложенный сценарий отложенного вычисления._

_Дать оценку затрат на выполнение операций расчёта балансов в рамках транзакций создания и изменения платежа. Дать заключение о полученном росте производительности, если таковое будет наблюдаться._

_Дать оценку возникшим проблемам и недостаткам, сравнить их с оценками, сделанными при проектировании сценария оптимизации (указать, что сбылось, что неожиданно проявилось и т.д.)._

_Дать заключение о преимуществах и недостатках выполненной оптимизации (превосходят ли полученные преимущества те недостатки, которые возникли после оптимизации)._



_Реализация сценария отложенного вычисления._

Для задач 3-го уровня выбран второй сценарий с определением максимального количества вносимых необработанных записей во вспомогательную таблицу. Этот подход позволяет избежать ручного вызова переноса данных и перерасчета балансов.

Реализация включала создание вспомогательной таблицы `PaymentDelayed` и триггера для нее. После каждой вставки новой записи в данную таблицу триггер вычисляет количество записей. При превышении максимального заданного количества происходит перенос всех новых записей в основную таблицу `Payment`. В качестве максимального размера таблицы было выбрано 100 записей, что позволит рассмотреть производительность в различных сценариях.


_Оценка затрат и роста производительности._

Для оценки затрат использовался инструмент SQLQueryStress. Сравнение проводилось при различных количествах вносимых записей и задержках между запросами.

**Результаты без задержки:**
- В изначальной реализации:
  - Для 10 записей: 0.68 секунд
  - Для 100 записей: 4.84 секунд
  - Для 400 записей: 48.47 секунд
- В предложенной реализации:
  - Для 10 записей: 0.04 секунды
  - Для 100 записей: 1.18 секунды
  - Для 400 записей: 3.57 секунды

**Результаты с задержкой (100 мс):**
- В изначальной реализации:
  - Для 10 записей: 3.94 секунды
  - Для 100 записей: 41.95 секунды
  - Для 400 записей: 3 мин 37.93 секунды
- В предложенной реализации:
  - Для 10 записей: 2.2 секунды
  - Для 100 записей: 12.15 секунды
  - Для 400 записей: 48.21 секунды

Производительность новой реализации значительно выше, особенно при больших объемах данных. Прирост производительности составляет примерно в 4 раза, что значительно улучшает время выполнения операций.


_Оценка проблем и недостатков._

1. **Обновление записей:** Предложенный сценарий не оптимизирует обновление существующих записей, что может потребовать дополнительных усилий при модификации данных. Реализация с использованием дополнительного столбца в таблице могла бы решить эту проблему.
   
2. **Оптимальность размера вспомогательной таблицы:** Неясно, насколько оптимальным является выбранный размер вспомогательной таблицы. Необходимы дополнительные исследования для определения оптимального значения.

3. **Сложность понимания:** Использование вспомогательной таблицы может запутать новых пользователей, требуя дополнительного времени на изучение структуры базы данных. Однако этот недостаток можно уменьшить, предоставив пользователям простой интерфейс для работы с данными.



_Заключение о преимуществах и недостатках._

Преимущества новой реализации, такие как значительный прирост производительности, перевешивают недостатки, такие как сложность обновления записей и увеличенная сложность для новых пользователей. Учитывая, что основная цель оптимизации - повышение производительности, новая реализация представляет собой значительное улучшение.